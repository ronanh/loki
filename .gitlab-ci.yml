include:
  - project: supervision-team/continuous-delivery-automation
    file: templates/trigger-source-code-mirror.yml
  - component: $CI_SERVER_FQDN/components/go/lint@0.7.2
  - component: $CI_SERVER_FQDN/components/go/test@0.7.2
    inputs:
      go_image: golang:${GO_VERSION}
  - component: $CI_SERVER_FQDN/components/go/build@0.7.2
    inputs:
      go_image: golang:${GO_VERSION}
      binary_directory: ""

variables:
  GO_VERSION: 1.25

stages:
  - check
  - test
  - build
  - deploy

default:
  interruptible: true

# global rules applying to all jobs
workflow:
  rules:
    # these rules prevent duplicate pipelines from running when opening a merge request
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_TAG
    - if: $CI_COMMIT_REF_PROTECTED == "true"

go:lint:
  allow_failure: true
